name: Daily n8n Backup (Production Only)

on:
  workflow_dispatch:
    # Cho ph√©p k√≠ch ho·∫°t th·ªß c√¥ng
  schedule:
    - cron: '15 0 * * *' # 7h15 s√°ng gi·ªù Vi·ªát Nam (UTC+7)

jobs:
  backup:
    if: ${{ github.ref_name == 'master' }}
    runs-on: self-hosted
    name: Daily n8n Backup (Production Only)
    steps:
      # B·ªè b∆∞·ªõc checkout code, s·ª≠ d·ª•ng lu√¥n th∆∞ m·ª•c deploy production
      - name: Thi·∫øt l·∫≠p bi·∫øn th∆∞ m·ª•c deploy production
        run: echo "DEPLOY_DIR=deploy_${GITHUB_REF_NAME}" >> $GITHUB_ENV

      - name: Ki·ªÉm tra file .env v√† script backup-n8n.sh
        run: |
          cd $DEPLOY_DIR
          if [ ! -f .env ]; then
            echo "‚ùå Kh√¥ng t√¨m th·∫•y file .env trong $DEPLOY_DIR"; exit 1;
          fi
          if [ ! -f backup-n8n.sh ]; then
            echo "‚ùå Kh√¥ng t√¨m th·∫•y script backup-n8n.sh trong $DEPLOY_DIR"; exit 1;
          fi

      - name: Th·ª±c thi backup
        run: |
          cd $DEPLOY_DIR
          echo "üîí ƒêang backup d·ªØ li·ªáu n8n cho m√¥i tr∆∞·ªùng production..."
          bash ./backup-n8n.sh
          echo "‚úÖ ƒê√£ backup d·ªØ li·ªáu n8n th√†nh c√¥ng" 